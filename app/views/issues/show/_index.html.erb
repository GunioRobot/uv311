<div class="issue">
  <div class="tally span-3" >
    <label><%= @issue.votes.count %></label>
    <span>Agree</span>
  </div>
  <div class="span-18">
    <h3><%= @issue.title %></h3>
  <p>
    <%=h @issue.description %>
  </p>
	<%= image_tag(@issue.picture.url(:small)) %>	
  </div>
</div>

<div id="new_comment">
<h2>Add a comment:</h2>

<% form_for(@comment) do |f| %>  
  <%= f.hidden_field :issue_id %>
  <%= f.label :author, 'Your Name' %>
  <%= f.text_field :author %>
  <%= f.label :body, 'Body' %>
  <%= f.text_area :body, :cols => 30, :rows => 5 %><br/>
  <%= submit_tag 'Add Comment' %> or <input type="button" onclick="sendToFacebook('<%=h @issue.description %>', '<%= @issue.picture.url(:small) %>')" value="Publish to Facebook"/>
<% end %>
</div>

<br/>

<div id="comments">
  <% @comments.each do |comment| %>
    <div class="comment">
      <p>
        <strong><%=h comment.author %></strong> said:<br/>
        <%=h comment.body %>
      </p>
    </div>
  <% end %>
</div>

<script type="text/javascript">

function sendToFacebook(desc, img_url) {
	var the_url;
	if (img_url == '/pictures/small/missing.png') {
		the_url = 'http://easy311.org/images/logo.gif'
	} else {
		alert(img_url)
		the_url = img_url
	}
	FB.ensureInit(function() {
	var template_stuff = {"images":[{"src":the_url, "href":"http://easy311.org"}]}; 
	
	var body_general = "Description: " + desc
	var user_message_prompt = "Lets make DC a better place to live!";
	var x = FB.Connect.showFeedDialog(93980376023, template_stuff, null, body_general, null, FB.RequireConnect.require, null);
	});
}
</script>
